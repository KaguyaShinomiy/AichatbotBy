<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‡∏ï‡∏±‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
  <link rel="stylesheet" href="MainPage.css">
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="icon home-icon"></div>
             <div class="chat-title" id="chat-title">‡∏ï‡∏±‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
      <div class="icon menu-icon"></div>
      <div class="menu-popup" id="menu-popup">
        <div class="menu-item">
          <span>‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</span>
          <label class="switch">
            <input type="checkbox" id="darkmode-toggle">
            <span class="slider"></span>
          </label>
        </div>
        <div class="menu-item">
          <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</span>
          <button class="change-topic-btn" onclick="changeTopic()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
        </div>
        <div class="menu-item">
          <span>‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</span>
          <button class="end-chat-btn" onclick="endChat()">‡∏à‡∏ö</button>
        </div>

      </div>
    </div>
    
    <div class="category-info" id="category-info" style="display: none;">
      <div class="category-badge" id="category-badge">
        <span class="category-icon" id="category-icon">üí≠</span>
        <span class="category-name" id="category-name">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
      </div>
      <div class="category-description" id="category-description">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</div>
    </div>
    
    <div class="chat-main" id="chat-main">
      <!-- Chat messages will appear here -->
    </div>
    <div class="chat-input-area">
      <input type="text" id="chat-input" placeholder="‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏â‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠">
      <button id="send-btn">‡∏™‡πà‡∏á</button>
    </div>
  </div>
      <script src="index.js"></script>
  <div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(255,240,246,0.85); z-index:9999; align-items:center; justify-content:center;">
    <div class="thinking-dots" style="font-size:3rem;">
      <span></span><span></span><span></span>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Menu popup logic
      const menuIcon = document.querySelector('.menu-icon');
      const menuPopup = document.getElementById('menu-popup');
      document.addEventListener('click', function(e) {
        if (menuIcon && menuPopup) {
          if (menuIcon.contains(e.target)) {
            menuPopup.classList.toggle('active');
          } else if (!menuPopup.contains(e.target)) {
            menuPopup.classList.remove('active');
          }
        }
      });

      // Dark mode toggle logic
      const darkToggle = document.getElementById('darkmode-toggle');
      if (darkToggle) {
        // Load saved mode
        if (localStorage.getItem('darkmode') === 'true') {
          document.body.classList.add('darkmode');
          darkToggle.checked = true;
        }
        darkToggle.addEventListener('change', function() {
          if (darkToggle.checked) {
            document.body.classList.add('darkmode');
            localStorage.setItem('darkmode', 'true');
          } else {
            document.body.classList.remove('darkmode');
            localStorage.setItem('darkmode', 'false');
          }
        });
      }

      // Home icon loading overlay
      const homeIcon = document.querySelector('.home-icon');
      const loadingOverlay = document.getElementById('loading-overlay');
      if (homeIcon && loadingOverlay) {
        homeIcon.addEventListener('click', function() {
          loadingOverlay.style.display = 'flex';
          setTimeout(() => {
            window.location.href = 'FrontPage.html';
          }, 1000);
        });
      }
      
      // Check for selected category and display it
      checkSelectedCategory();
      
      // Add welcome message based on category
      addWelcomeMessage();
    });
    
    // Check if user has selected a category
    function checkSelectedCategory() {
      const selectedCategory = localStorage.getItem('selectedChatCategory');
      const categoryData = localStorage.getItem('selectedChatCategoryData');
      
      if (selectedCategory && categoryData) {
        const data = JSON.parse(categoryData);
        displayCategoryInfo(data);
      }
    }
    
    // Display category information
    function displayCategoryInfo(data) {
      const categoryInfo = document.getElementById('category-info');
      const categoryIcon = document.getElementById('category-icon');
      const categoryName = document.getElementById('category-name');
      const categoryDescription = document.getElementById('category-description');
      const chatTitle = document.getElementById('chat-title');
      
      if (categoryInfo && categoryIcon && categoryName && categoryDescription) {
        categoryIcon.textContent = data.title.split(' ')[1]; // Get emoji from title
        categoryName.textContent = data.title.split(' ')[0]; // Get text from title
        categoryDescription.textContent = data.description;
        categoryInfo.style.display = 'block';
        
                 // Update chat title
         if (chatTitle) {
           chatTitle.textContent = `‡∏ï‡∏±‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ${data.title.split(' ')[0]}`;
         }
      }
    }
    
    // Add welcome message based on category
    function addWelcomeMessage() {
      const selectedCategory = localStorage.getItem('selectedChatCategory');
      const categoryData = localStorage.getItem('selectedChatCategoryData');
      const chatMain = document.getElementById('chat-main');
      
      if (chatMain && chatMain.children.length === 0) { // Only add if chat is empty
        let welcomeMessage = '';
        
        if (selectedCategory && categoryData) {
          try {
            const data = JSON.parse(categoryData);
            welcomeMessage = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ <strong>${data.title.split(' ')[0]}</strong> 
‡∏â‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏¢‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì 
‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üòä`;
          } catch (e) {
            console.error('Error parsing category data:', e);
            welcomeMessage = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì 
‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üòä`;
          }
        } else {
          welcomeMessage = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì 
‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üòä`;
        }
        
        const welcomeDiv = document.createElement('div');
        welcomeDiv.className = 'message-row ai';
        welcomeDiv.innerHTML = `
          <div class="profile-ai">
            <div class="profile-avatar">
              <img src="MascotP.png" alt="‡∏ï‡∏±‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤" class="mascot-avatar">
            </div>
            <div class="profile-name">‡∏ï‡∏±‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
          </div>
          <div class="message message-bubble ai">
            <span>${welcomeMessage}</span>
          </div>
        `;
        chatMain.appendChild(welcomeDiv);
        chatMain.scrollTop = chatMain.scrollHeight;
      }
    }
    
    // Function to change topic
    function changeTopic() {
      // Clear current category
      localStorage.removeItem('selectedChatCategory');
      localStorage.removeItem('selectedChatCategoryData');
      
      // Redirect to category page
      window.location.href = 'CategoryPage.html';
    }
    
    // Function to end chat and go to conclusion page
    function endChat() {
      // Store chat conversation data for conclusion page
      const chatMain = document.getElementById('chat-main');
      if (chatMain) {
        const messages = chatMain.querySelectorAll('.message');
        const chatData = [];
        
        messages.forEach(message => {
          const messageText = message.querySelector('.message-text');
          const messageTime = message.querySelector('.message-time');
          
          if (messageText && messageTime) {
            const sender = message.classList.contains('bot-message') ? 'ai' : 'user';
            const text = messageText.textContent || messageText.innerText;
            
            // Only store meaningful messages (not empty or very short)
            if (text.trim().length > 2) {
              chatData.push({
                sender: sender,
                text: text.trim(),
                time: messageTime.textContent
              });
            }
          }
        });
        
        // Store chat data in localStorage
        if (chatData.length > 0) {
          localStorage.setItem('chatConversation', JSON.stringify(chatData));
          console.log('Chat data stored:', chatData);
        } else {
          localStorage.setItem('chatConversation', JSON.stringify([]));
        }
      }
      
      // Show loading and redirect to conclusion page
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) {
        loadingOverlay.style.display = 'flex';
        setTimeout(() => {
          window.location.href = 'ConclusionPage.html';
        }, 1000);
      } else {
        window.location.href = 'ConclusionPage.html';
      }
    }

  </script>
</body>
</html>
